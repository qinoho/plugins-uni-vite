(function(p,W){typeof exports=="object"&&typeof module<"u"?W(exports,require("@vue/compiler-sfc"),require("path"),require("fs")):typeof define=="function"&&define.amd?define(["exports","@vue/compiler-sfc","path","fs"],W):(p=typeof globalThis<"u"?globalThis:p||self,W(p.UniV3Plugin={},p["@vue/compiler-sfc"],p.path,p.fs))})(this,function(p,W,_,U){"use strict";function z(u){const h=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(u){for(const y in u)if(y!=="default"){const v=Object.getOwnPropertyDescriptor(u,y);Object.defineProperty(h,y,v.get?v:{enumerable:!0,get:()=>u[y]})}}return h.default=u,Object.freeze(h)}const l=z(_),D=z(U);function k(u={}){const{extensions:h=[".png",".jpg",".jpeg",".gif",".svg",".webp"],replacementFn:y,srcRoot:v="src",enableReplace:b=!1,replacements:B,excludeUnused:I=!0,additionalChecks:F=[]}=u,m=new Set,j=new Map,S=new Map,R=new Set,E=e=>{if(e.startsWith("http")||e.startsWith("data:")||!e.includes("."))return!1;const t=l.extname(e).toLowerCase();return h.includes(t)},M=(e,t)=>{if(e.startsWith("@/"))return l.resolve(v,e.slice(2));if(e.startsWith("./")||e.startsWith("../")){const o=l.dirname(t);return l.resolve(o,e)}return l.isAbsolute(e)?e:l.resolve(v,e)},O=(e,t)=>{if(typeof y=="function"){const o=y(t,e);if(o)return o}return t},A=(e,t,o,n)=>{S.has(n)||S.set(n,[]);const c=S.get(n);c&&c.push({type:e,original:t,replacement:o})},L=e=>{if(!D.existsSync(e))return;const t=D.readdirSync(e,{withFileTypes:!0});for(const o of t){const n=l.join(e,o.name);if(o.isDirectory())L(n);else{const c=l.extname(o.name).toLowerCase();h.includes(c)&&R.add(n)}}};return{name:"detect-static",enforce:"pre",transform(e,t){if(t.endsWith(".vue")){debugger;try{const{descriptor:o}=W.parse(e);let n=!1,c=e;const x=o.script||o.scriptSetup;if(x){let s=x.content;const C=/import\s+(?:(\w+)|{([^}]+)}|\*\s+as\s+(\w+))\s+from\s+['"]([^'"]+)['"]/g;let w;for(;(w=C.exec(s))!==null;){const[a,r,d,i,f]=w;if(E(f)){const g=M(f,t);if(r&&(j.set(r,{originalPath:f,resolvedPath:g}),console.log(`ğŸ“¦ æ£€æµ‹åˆ°é»˜è®¤å¯¼å…¥èµ„æº: ${r} -> ${f}==${g}`),b)){const $=O(g,f);if($){if($.startsWith("http")){const T=`const ${r} = '${$}'`;s=s.replace(a,T),A("import-to-url",f,$,t),console.log(`ğŸ”„ æ›¿æ¢å¯¼å…¥ä¸ºURLå˜é‡: ${r} = '${$}'`)}else{const T=a.replace(f,$);s=s.replace(a,T),A("import",f,$,t),console.log(`ğŸ”„ æ›¿æ¢å¯¼å…¥è·¯å¾„: ${f} -> ${$}`)}n=!0}}}}n&&s!==x.content&&(c=c.replace(x.content,s))}if(o.template){let s=o.template.content;const C=new RegExp(`(?<!:)src\\s*=\\s*["']([^"']+)["']`,"g");s=s.replace(C,(a,r)=>{if(E(r)){const d=M(r,t);if(m.add(d),console.log(`ğŸ“¦ æ£€æµ‹åˆ°é™æ€èµ„æº: ${r} -> ${d}`),b){const i=O(d,r);if(i)return A("template-static",r,i,t),console.log(a.replace(r,i)),a.replace(r,i)}}return a});const w=/:src\s*=\s*["']([^"']+)["']/g;s=s.replace(w,(a,r)=>{if(j.has(r)){const d=j.get(r),{resolvedPath:i}=d;m.add(i),console.log(`ğŸ“¦ æ£€æµ‹åˆ°åŠ¨æ€ç»‘å®šèµ„æº: ${r} -> ${i}`)}else console.log(`âš ï¸  æ£€æµ‹åˆ°åŠ¨æ€ç»‘å®š: ${r} (åœ¨ ${t}) - éœ€è¦æ‰‹åŠ¨æ£€æŸ¥`);return a}),s!==o.template.content&&(n=!0,c=c.replace(o.template.content,s))}if(o.styles&&o.styles.length>0)for(let s=0;s<o.styles.length;s++){const C=o.styles[s];let w=C.content;const a=/url\s*\(\s*["']?([^"')]+)["']?\s*\)/g,r=w.replace(a,(d,i)=>{if(E(i)){const f=M(i,t);if(m.add(f),console.log(`ğŸ“¦ æ£€æµ‹åˆ°CSSèµ„æº: ${i} -> ${f} (styleå— ${s+1})`),b){const g=O(f,i);if(g)return A("css-url",i,g,t),console.log(`ğŸ”„ æ›¿æ¢CSSèµ„æº: ${i} -> ${g} (styleå— ${s+1})`),d.replace(i,g)}}return d});r!==w&&(n=!0,c=c.replace(C.content,r))}return n?{code:c,map:null}:null}catch(o){console.warn(`è§£æ Vue æ–‡ä»¶å¤±è´¥: ${t}`,o)}}},buildStart(e){console.log("ğŸ” å¼€å§‹æ£€æµ‹æ¨¡æ¿ä¸­çš„é™æ€èµ„æº..."),m.clear(),j.clear(),S.clear(),L(v)},buildEnd(){if(console.log(`
ğŸ“Š æ£€æµ‹ç»“æœæ±‡æ€»:`),console.log(`å…±æ‰«æåˆ° ${R.size} ä¸ªé™æ€èµ„æº`),console.log(`å…±æ£€æµ‹åˆ° ${m.size} ä¸ªå·²ä½¿ç”¨èµ„æº:`),m.forEach(e=>{console.log(`  âœ… ${l.relative(process.cwd(),e)}`)}),I){const e=Array.from(R).filter(t=>!m.has(t));e.length>0&&(console.log(`
âš ï¸  å‘ç° ${e.length} ä¸ªæœªä½¿ç”¨çš„èµ„æº:`),e.forEach(t=>{console.log(`  âŒ ${l.relative(process.cwd(),t)}`)}),console.log(`
ğŸ’¡ è¿™äº›èµ„æºå·²è¢«é˜»æ­¢æ‰“åŒ…ï¼Œå»ºè®®æ‰‹åŠ¨åˆ é™¤ä»¥æ¸…ç†é¡¹ç›®`))}b&&S.size>0&&(console.log(`
ğŸ”„ æ›¿æ¢æ“ä½œæ±‡æ€»:`),S.forEach((e,t)=>{console.log(`
æ–‡ä»¶: ${t}`),e.forEach(({type:o,original:n,replacement:c})=>{console.log(`  [${o}] ${n} -> ${c}`)})}))},resolveId(e,t){const o=l.extname(e).toLowerCase();if(h.includes(o)){let n=e;if(e.startsWith("@/")?n=l.resolve(v,e.replace("@/","")):(e.startsWith("./")||e.startsWith("../"))&&(n=l.resolve(l.dirname(t||""),e)),n=l.normalize(n),I&&R.has(n)){let c=!1;if(F.forEach(x=>{x(n)&&(m.add(n),c=!0)}),!m.has(n)&&!c)return console.log(`ğŸš« é˜»æ­¢æœªä½¿ç”¨èµ„æº: ${l.relative(process.cwd(),n)}`),!1}}return null}}}function q(u){return`Hello, ${u}!`}p.detectStatic=k,p.hello=q,Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})});
